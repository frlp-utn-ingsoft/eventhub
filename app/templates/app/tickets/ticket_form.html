{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <form method="post">
        {% csrf_token %}

        <div class="card shadow-sm border-0">
            <div class="card-header bg-dark text-white">
                <h2 class="mb-0">Comprar Entrada</h2>
            </div>

            <div class="card-body">
                <div class="mb-4 p-3 border rounded">
                    <div class="form-group">
                        <label for="{{ form.event.id_for_label }}" class="form-label">Seleccionar Evento</label>
                        {{ form.event }}
                    </div>

                    <div class="mt-3">
                        <h3 class="text-primary" id="event-title-display">Seleccione un evento</h3>
                    </div>
                </div>

                <div class="mb-4 p-3 border rounded">
                    <h4><i class="bi bi-ticket-perforated"></i> Cantidad de entradas</h4>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="{{ form.type.id_for_label }}" class="form-label">Tipo de entrada</label>
                            {{ form.type }}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.quantity.id_for_label }}" class="form-label">Cantidad</label>
                            {{ form.quantity }}
                            <small class="text-muted d-block mt-1">Máximo 4 entradas por evento</small>
                        </div>
                    </div>
                </div>

                <div class="form-check mb-4">
                    <input class="form-check-input" type="checkbox" id="terms" required>
                    <label class="form-check-label" for="terms">
                        Acepto los términos y condiciones
                    </label>
                </div>

                <div class="mb-4 p-3 border rounded bg-light">
                    <h4><i class="bi bi-receipt"></i> Resumen de compra</h4>
                    <div class="row">
                        <div class="col-6">
                            <p>Precio por entrada:</p>
                            <p>Cantidad:</p>
                            <p>Subtotal:</p>
                            <p>Impuestos (10%):</p>
                            <p class="fw-bold">Total:</p>
                        </div>
                        <div class="col-6 text-end">
                            <p id="precio-unitario">$50.00</p>
                            <p id="resumen-cantidad">1</p>
                            <p id="subtotal">$50.00</p>
                            <p id="impuestos">$5.00</p>
                            <p class="fw-bold" id="total">$55.00</p>
                        </div>
                    </div>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-check-circle-fill"></i> Confirmar compra
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const tipoEntrada = document.getElementById('id_type');
        const cantidadInput = document.getElementById('id_quantity');
        const precioUnitarioEl = document.getElementById('precio-unitario');
        const cantidadEl = document.getElementById('resumen-cantidad');
        const subtotalEl = document.getElementById('subtotal');
        const impuestosEl = document.getElementById('impuestos');
        const totalEl = document.getElementById('total');
        const eventSelect = document.getElementById('id_event');
        const eventTitleDisplay = document.getElementById('event-title-display');

        function actualizarResumen() {
            let cantidad = parseInt(cantidadInput.value) || 1;
            if (cantidad > 4) {
                cantidad = 4;
                cantidadInput.value = 4;
                alert("No puedes comprar más de 4 entradas");
            }

            const precioUnitario = tipoEntrada.value === 'VIP' ? 100 : 50;
            const subtotal = precioUnitario * cantidad;
            const impuestos = subtotal * 0.1;
            const total = subtotal + impuestos;

            precioUnitarioEl.textContent = `$${precioUnitario.toFixed(2)}`;
            cantidadEl.textContent = cantidad;
            subtotalEl.textContent = `$${subtotal.toFixed(2)}`;
            impuestosEl.textContent = `$${impuestos.toFixed(2)}`;
            totalEl.textContent = `$${total.toFixed(2)}`;
        }

        tipoEntrada.addEventListener('change', actualizarResumen);
        cantidadInput.addEventListener('input', actualizarResumen);

        eventSelect.addEventListener('change', function () {
            const texto = eventSelect.options[eventSelect.selectedIndex].text;
            eventTitleDisplay.textContent = texto || "Seleccione un evento";
        });

        actualizarResumen();
    });
</script>
{% endblock %}
